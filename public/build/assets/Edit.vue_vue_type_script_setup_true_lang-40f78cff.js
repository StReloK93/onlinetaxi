import{r as z,p as L,m as q,h as J}from"./constants-68fdd4d6.js";import{d as E,p as P,r as c,A as I,o as C,c as R,w as u,j as Y,y as K,F as j,e as n,g as h,b as F,B as A,D as W,f as S,h as T,n as X,C as Z,k as U,q as ee,x as Q,S as H}from"./app-bfb27f04.js";const te={class:"d-flex w-100 mb-3"},ae=F("img",{src:"/iconos/uz.png"},null,-1),O=E({__name:"Inputs",emits:["onReady","onStart"],setup(v,{expose:k,emit:g}){const i=g;i("onStart");const e=P({user_car_id:null,phone:null,strictly_on_time:!1,address_to_address:!1,ends:[{region:null,city:null,loading:!1,districts:[]},{region:null,city:null,loading:!1,districts:[]}],day:null,price:"",free_seat:null}),y=P({overlay:!0,cars:[],regions:[]});function w(s){e.ends.splice(s,1)}function r(s){const a=y.cars.find(p=>p.id==s);e.phone=a.user.phone}async function o(s,a){e.ends[a].loading=!0,e.ends[a].city=null,e.ends[a].districts=[],await axios.get(`district/${s}`).then(({data:p})=>{e.ends[a].districts=p,e.ends[a].loading=!1})}return axios.all([axios.get("user-cars/get-only-my"),axios.get("region")]).then(axios.spread(({data:s},{data:a})=>{y.cars=s,y.regions=a,i("onReady")})),k({regionChanged:o,formData:e}),(s,a)=>{const p=c("v-label"),V=c("v-col"),_=c("v-autocomplete"),b=c("v-btn"),B=c("v-divider"),M=c("VDatePicker"),t=c("v-text-field"),d=c("v-icon"),m=c("v-switch"),f=c("v-row"),D=I("maska"),N=I("money3");return C(),R(f,null,{default:u(()=>[(C(!0),Y(j,null,K(e.ends,(l,$)=>(C(),Y(j,null,[$==0?(C(),R(V,{key:0,cols:"12",class:"py-1"},{default:u(()=>[n(p,{class:"text-subtitle-1 mr-1"},{default:u(()=>[S(" Qaerdan? ")]),_:1})]),_:1})):T("",!0),e.ends.length==$+1?(C(),R(V,{key:1,cols:"12",class:"py-1"},{default:u(()=>[n(p,{class:"text-subtitle-1 mr-1"},{default:u(()=>[S(" Qaerga? ")]),_:1})]),_:1})):T("",!0),F("div",{class:X(["w-100 d-flex flex-wrap bg-blue-grey-lighten-5",{"px-0":[1,2].includes($)&&$!=e.ends.length-1}])},[n(V,{sm:"6",cols:"12"},{default:u(()=>[n(_,{modelValue:l.region,"onUpdate:modelValue":[x=>l.region=x,x=>o(x,$)],items:y.regions,label:"Viloyat","item-title":"name","item-value":x=>x.id,rules:h(z)},null,8,["modelValue","onUpdate:modelValue","items","item-value","rules"])]),_:2},1024),n(V,{sm:"6",cols:"12",class:"d-flex align-center"},{default:u(()=>[n(_,{disabled:l.region==null,modelValue:l.city,"onUpdate:modelValue":x=>l.city=x,items:l.districts,label:"Shahar (Tuman)","item-title":"name","item-value":x=>x.id,loading:l.loading,rules:h(z)},null,8,["disabled","modelValue","onUpdate:modelValue","items","item-value","loading","rules"]),[1,2].includes($)&&$!=e.ends.length-1?(C(),R(b,{key:0,onClick:x=>w($),size:"x-small",icon:"mdi-minus",class:"ml-2",variant:"plain"},null,8,["onClick"])):T("",!0)]),_:2},1024)],2)],64))),256)),n(B,{class:"border-opacity-75"}),n(V,{sm:"6",cols:"12"},{default:u(()=>[n(M,{"trim-weeks":!0,color:"pink","min-date":new Date,modelValue:e.day,"onUpdate:modelValue":a[0]||(a[0]=l=>e.day=l),modelModifiers:{string:!0},masks:{modelValue:"YYYY-MM-DD HH:mm"},mode:"dateTime",is24hr:"",transparent:"",borderless:"",expanded:"","hide-time-header":"","is-required":""},null,8,["min-date","modelValue"]),n(t,{class:"hidden tw-relative -tw-top-2",hidden:"",modelValue:e.day,"onUpdate:modelValue":a[1]||(a[1]=l=>e.day=l),rules:h(z),readonly:""},null,8,["modelValue","rules"])]),_:1}),n(V,{sm:"6",cols:"12"},{default:u(()=>[n(_,{class:"mb-3","onUpdate:modelValue":[r,a[2]||(a[2]=l=>e.user_car_id=l)],items:y.cars,modelValue:e.user_car_id,label:"Transport","item-title":l=>`${l.car.name} ( ${l.number} )`,"item-value":l=>l.id,rules:h(z)},null,8,["items","modelValue","item-title","item-value","rules"]),F("main",te,[n(t,{class:"pr-2 flex-0-0",readonly:"",density:"compact",value:"+998",disabled:""},{"prepend-inner":u(()=>[n(d,null,{default:u(()=>[ae]),_:1})]),_:1}),A(n(t,{inputmode:"tel",modelValue:e.phone,"onUpdate:modelValue":a[3]||(a[3]=l=>e.phone=l),density:"compact",rules:h(z)},null,8,["modelValue","rules"]),[[D,void 0,h(L)]])]),n(t,{label:"Narxi",rules:h(z),modelValue:e.price,"onUpdate:modelValue":a[4]||(a[4]=l=>e.price=l),modelModifiers:{lazy:!0},class:"mb-3"},null,8,["rules","modelValue"]),n(t,{modelValue:e.free_seat,"onUpdate:modelValue":a[5]||(a[5]=l=>e.free_seat=l),type:"number",label:"Bosh o'rindiqlar",class:"mb-3",rules:h(z)},null,8,["modelValue","rules"]),A(F("input",{"onUpdate:modelValue":a[6]||(a[6]=l=>e.price=l),type:"text",hidden:""},null,512),[[N,h(q)],[W,e.price,void 0,{lazy:!0}]]),n(m,{modelValue:e.strictly_on_time,"onUpdate:modelValue":a[7]||(a[7]=l=>e.strictly_on_time=l),label:"Qat'iy shu vaqtda",class:"px-2"},null,8,["modelValue"]),n(m,{modelValue:e.address_to_address,"onUpdate:modelValue":a[8]||(a[8]=l=>e.address_to_address=l),label:"Manzilgacha",class:"px-2"},null,8,["modelValue"])]),_:1})]),_:1})}}}),G=Z("useCarRide",()=>{const v=U(null),k=U(null),g=U(null),i=U([]),e=U([]),y=U(["car-ride-height","tw-shadow","tw-border-l-2","tw-border-pink-500","bg-white","tw-rounded-r","overflow-hidden"]);function w(){axios.get("car-ride").then(({data:t})=>i.value=t)}async function r(t){axios.get(`car-rides/start-region/${t}`).then(({data:d})=>{i.value=d.car_rides,e.value=d.districts})}function o(t){i.value.push(t),v.value!=null&&(v.value.applyTransaction({add:[t],addIndex:0}),v.value.onFilterChanged())}function s(t){const d=i.value.findIndex(f=>f.id==t.id);if(i.value[d]=t,v.value==null)return;v.value.getRowNode(t.id).updateData(t),v.value.onFilterChanged()}function a(t){axios.delete(`car-ride/${t.id}`).then(()=>{i.value=i.value.filter(d=>d.id!=t.id),v.value!=null&&v.value.applyTransaction({remove:[t]})})}async function p(t){await axios.delete(`car-rides/send-road/${t.id}`).then(()=>{i.value=i.value.filter(d=>d.id!=t.id)})}const V=ee(()=>{var d;const t={};return(d=e.value)==null||d.forEach(m=>{i.value.forEach(f=>{if(m.id==f.cities[0].district_id){let D=`${f.cities.at(-1).district.region.name} ${f.cities.at(-1).district.name}`;const N=D.split(" ");J(N)&&(D=f.cities.at(-1).district.name),t[m.name]?t[m.name][D]?t[m.name][D].push(f):t[m.name][D]=[f]:(t[m.name]={},t[m.name][D]=[f])}})}),t});function _(t){i.value.find(m=>m.id==t.car_ride_id).passengers.push(t)}function b(t){const d=i.value.find(f=>f.id==t.car_ride_id),m=d.passengers.findIndex(f=>f.id==t.id);d.passengers[m]=t}function B(t){const d=i.value.find(m=>m.id==t.car_ride_id);d.passengers=d.passengers.filter(m=>m.id!=t.id)}function M(){v.value=null,k.value=null,g.value=null,i.value=[],e.value=[],y.value=[]}return{agGrid:v,agColumnApi:k,rides:i,agRowHeight:g,rowClass:y,districts:e,groupRides:V,sendRoad:p,create:o,update:s,destroy:a,index:w,indexCity:r,createPassenger:_,updatePassenger:b,deletedPassenger:B,clear:M}}),oe=E({__name:"Add",props:["date","btnClass"],setup(v){const k=G(),g=v,i=U(),e=P({dialog:!1,overlay:!0});async function y(){const w=i.value.formData;w.price=H(w.price,q),await axios.post("car-ride",w).then(({data:r})=>k.create(r))}return(w,r)=>{const o=c("v-btn"),s=c("v-progress-circular"),a=c("v-overlay"),p=c("CustomForm"),V=c("v-dialog");return C(),R(V,{modelValue:e.dialog,"onUpdate:modelValue":r[4]||(r[4]=_=>e.dialog=_),scrollable:"",width:"600px"},{activator:u(({props:_})=>[n(o,Q({color:"primary"},_,{icon:"mdi-plus",class:[g.btnClass,"add-button"]}),null,16,["class"])]),default:u(()=>[n(p,{submit:y,title:"Qatnov kiritish",onClose:r[3]||(r[3]=_=>e.dialog=!1)},{default:u(()=>[n(a,{modelValue:e.overlay,"onUpdate:modelValue":r[0]||(r[0]=_=>e.overlay=_),contained:"",persistent:"",class:"align-center justify-center"},{default:u(()=>[n(s,{color:"primary",indeterminate:"",size:68})]),_:1},8,["modelValue"]),n(O,{onOnStart:r[1]||(r[1]=_=>e.overlay=!0),onOnReady:r[2]||(r[2]=_=>e.overlay=!1),ref_key:"inputComponent",ref:i,date:g.date},null,8,["date"])]),_:1})]),_:1},8,["modelValue"])}}}),se=E({__name:"Edit",props:["id","smButton"],setup(v){const k=G(),g=U(),i=v,e=P({dialog:!1,car_ride:null,overlay:!0});async function y(){const r=g.value.formData;r.price=H(r.price,q),await axios.put(`car-ride/${e.car_ride.id}`,r).then(async({data:o})=>{k.update(o),e.dialog=!1})}function w(r){e.overlay=!0,axios.get(`car-ride/${r}`).then(async({data:o})=>{e.car_ride=o;const s=g.value.formData;s.user_car_id=o.user_car_id,s.phone=o.phone,s.day=o.day,s.strictly_on_time=o.strictly_on_time,s.price=o.price,s.address_to_address=o.address_to_address,s.free_seat=o.free_seat,s.ends=[],await Promise.all(o.cities.map(async(a,p)=>{s.ends.push({region:null,city:null,loading:!1,districts:[]}),await g.value.regionChanged(a.district.region_id,p),s.ends[p].region=a.district.region_id,s.ends[p].city=a.district_id,e.overlay=!1}))})}return(r,o)=>{const s=c("v-btn"),a=c("v-progress-circular"),p=c("v-overlay"),V=c("CustomForm"),_=c("v-dialog");return C(),R(_,{modelValue:e.dialog,"onUpdate:modelValue":o[3]||(o[3]=b=>e.dialog=b),scrollable:"",width:"600px"},{activator:u(({props:b})=>[i.smButton?(C(),R(s,Q({key:0},b,{"prepend-icon":"mdi-pencil",size:"x-small",variant:"tonal",color:"white"}),{default:u(()=>[S(" O'zgaritirish ")]),_:2},1040)):(C(),R(s,Q({key:1,size:"x-small"},b,{variant:"plain",icon:"mdi-pencil"}),null,16))]),default:u(()=>[n(V,{submit:y,onVnodeMounted:o[1]||(o[1]=b=>w(i.id)),title:"Qatnovni tahrirlash",onClose:o[2]||(o[2]=b=>e.dialog=!1)},{default:u(()=>[n(p,{modelValue:e.overlay,"onUpdate:modelValue":o[0]||(o[0]=b=>e.overlay=b),contained:"",persistent:"",class:"align-center justify-center"},{default:u(()=>[n(a,{color:"primary",indeterminate:"",size:68})]),_:1},8,["modelValue"]),n(O,{ref_key:"inputComponent",ref:g},null,512)]),_:1},512)]),_:1},8,["modelValue"])}}});export{oe as _,se as a,G as u};
