import{d as Y,p as B,r as a,A as G,o as d,c as C,w as o,f as n,h as U,e as t,B as E,g as V,k as j,q as I,v as le,a as ae,t as b,j as y,x as S,F as z,i as O,D as W,n as X,E as se,m as ie,G as de,s as re}from"./app-0ba38769.js";import{r as q,p as Q,a as ce}from"./constants-68fdd4d6.js";import{u as Z,_ as ue,a as _e}from"./Edit.vue_vue_type_script_setup_true_lang-111620cd.js";const pe={class:"d-flex w-100"},me=t("img",{src:"/iconos/uz.png"},null,-1),ee=Y({__name:"Inputs",props:{freeSeat:{type:Number,required:!0},familyCount:{type:Number,default:0}},setup(P,{expose:h}){const f=P,i=B({car_ride_id:null,name:null,phone:null,loading:null,address:null,start_region:null,start_city:null,end_region:null,end_city:null,with_trunk:!1,ride_time:null,count:1}),s=B({start_loading:!1,end_loading:!1,regions:[],start_districts:[],end_districts:[]});async function g(r,e){s[`${e}_loading`]=!0,s[`${e}_districts`]=[],i[`${e}_city`]=null,await axios.get(`district/${r}`).then(({data:p})=>{s[`${e}_districts`]=p,s[`${e}_loading`]=!1})}return axios.get("region").then(({data:r})=>s.regions=r),h({regionChanged:g,formData:i}),(r,e)=>{const p=a("v-text-field"),c=a("v-col"),$=a("v-icon"),w=a("v-label"),u=a("v-autocomplete"),m=a("v-rating"),k=a("v-row"),_=G("maska");return d(),C(k,null,{default:o(()=>[n(c,{sm:"6",cols:"12"},{default:o(()=>[n(p,{modelValue:i.name,"onUpdate:modelValue":e[0]||(e[0]=l=>i.name=l),step:900,label:"F.I.SH",rules:U(q)},null,8,["modelValue","rules"])]),_:1}),n(c,{sm:"6",cols:"12"},{default:o(()=>[t("main",pe,[n(p,{class:"pr-2 flex-0-0",readonly:"",density:"compact",value:"+998",disabled:""},{"prepend-inner":o(()=>[n($,null,{default:o(()=>[me]),_:1})]),_:1}),E(n(p,{modelValue:i.phone,"onUpdate:modelValue":e[1]||(e[1]=l=>i.phone=l),density:"compact",rules:U(q)},null,8,["modelValue","rules"]),[[_,void 0,U(Q)]])])]),_:1}),n(c,{cols:"12",class:"py-0 text-center"},{default:o(()=>[n(w,{class:"text-caption"},{default:o(()=>[V(" Boriladigan manzil (Qaerga?) ")]),_:1})]),_:1}),n(c,{sm:"6",cols:"12"},{default:o(()=>[n(u,{"onUpdate:modelValue":[e[2]||(e[2]=l=>g(l,"end")),e[3]||(e[3]=l=>i.end_region=l)],items:s.regions,modelValue:i.end_region,label:"Viloyat","item-title":"name","item-value":l=>l.id,rules:U(q)},null,8,["items","modelValue","item-value","rules"])]),_:1}),n(c,{sm:"6",cols:"12"},{default:o(()=>[n(u,{disabled:i.end_region==null,items:s.end_districts,modelValue:i.end_city,"onUpdate:modelValue":e[4]||(e[4]=l=>i.end_city=l),label:"Shahar (Tuman)","item-title":"name","item-value":l=>l.id,loading:s.end_loading,rules:U(q)},null,8,["disabled","items","modelValue","item-value","loading","rules"])]),_:1}),n(c,{sm:"6",cols:"12"},{default:o(()=>[n(p,{modelValue:i.address,"onUpdate:modelValue":e[5]||(e[5]=l=>i.address=l),step:900,label:"Manzil",rules:U(q)},null,8,["modelValue","rules"])]),_:1}),n(c,{sm:"6",cols:"12",class:"overflow-hidden px-1"},{default:o(()=>[n(m,{density:"compact",modelValue:i.count,"onUpdate:modelValue":e[6]||(e[6]=l=>i.count=l),"empty-icon":"mdi-account-outline","full-icon":"mdi-account",class:"d-flex flex-wrap",length:f.freeSeat+f.familyCount,hover:""},null,8,["modelValue","length"])]),_:1})]),_:1})}}}),ve=Y({__name:"Add",props:["ride","disabled"],emits:["create"],setup(P,{emit:h}){const f=P,i=h,s=j(),g=B({dialog:!1}),r=I(()=>{const p=f.ride.passengers.reduce((c,$)=>c+=$.count,0);return f.ride.free_seat-p});async function e(){const p=s.value.formData;p.start_city=f.ride.cities[0].district_id,p.car_ride_id=f.ride.id,await axios.post("passenger-operator",p).then(({data:c})=>{i("create",c)})}return(p,c)=>{const $=a("v-icon"),w=a("v-btn"),u=a("CustomForm"),m=a("v-dialog");return d(),C(m,{modelValue:g.dialog,"onUpdate:modelValue":c[1]||(c[1]=k=>g.dialog=k),scrollable:"",persistent:"",width:"600px"},{activator:o(({props:k})=>[n(w,le({density:"compact"},k,{disabled:f.disabled}),{default:o(()=>[n($,null,{default:o(()=>[V("mdi-account-plus")]),_:1})]),_:2},1040,["disabled"])]),default:o(()=>[n(u,{submit:e,title:"Yo'lovchi kiritish",onClose:c[0]||(c[0]=k=>g.dialog=!1)},{default:o(()=>[n(ee,{ref_key:"inputComponent",ref:s,freeSeat:r.value},null,8,["freeSeat"])]),_:1})]),_:1},8,["modelValue"])}}}),fe=Y({__name:"Edit",props:["ride"],emits:["update"],setup(P,{expose:h,emit:f}){const i=P,s=j(),g=f,r=B({dialog:!1,passenger:null}),e=I(()=>i.ride.passengers.reduce((w,u)=>w+=u.count,0));async function p(){const w=s.value.formData;w.start_city=i.ride.cities[0].district_id,w.car_ride_id=i.ride.id,await axios.put(`passenger/${r.passenger.id}`,w).then(({data:u})=>g("update",u))}function c(w){axios.get(`passenger/${w}`).then(({data:u})=>{const m=s.value.formData;m.name=u.name,m.phone=u.phone,m.address=u.address,m.count=u.count,m.end_region=u.end.region_id,s.value.regionChanged(m.end_region,"end").then(()=>m.end_city=u.end_city)})}return h({toggle:w=>{r.dialog=!0,r.passenger=w,c(w.id)}}),(w,u)=>{const m=a("CustomForm"),k=a("v-dialog");return d(),C(k,{modelValue:r.dialog,"onUpdate:modelValue":u[1]||(u[1]=_=>r.dialog=_),scrollable:"",persistent:"",width:"600px"},{default:o(()=>[n(m,{submit:p,title:"Yo'lovchini tahrirlash",onClose:u[0]||(u[0]=_=>r.dialog=!1)},{default:o(()=>[n(ee,{ref_key:"inputComponent",ref:s,freeSeat:P.ride.free_seat-e.value,familyCount:r.passenger.count},null,8,["freeSeat","familyCount"])]),_:1})]),_:1},8,["modelValue"])}}}),ge={class:"d-flex justify-space-between tw-relative"},we=t("div",{class:"tw-border-b tw-absolute tw-w-full tw-z-0 tw-bottom-[9px] tw-border-dashed tw-border-gray-400"},null,-1),xe={class:"tw-text-base"},be={class:"text-right my-2 tw-text-xl tw-text-pink-600 tw-font-semibold"},he={class:"w-100 tw-border-collapse tw-text-sm"},ye=t("tr",null,[t("td",{class:"tw-border tw-p-1 tw-bg-gray-100"}," F.I.SH "),t("td",{class:"tw-border tw-p-1 tw-bg-gray-100"}," Telefon "),t("td",{class:"tw-border tw-p-1 tw-bg-gray-100"}," Manzil "),t("td",{class:"tw-border tw-p-1 tw-bg-gray-100"}," Boriladigan manzil "),t("td",{class:"tw-border tw-p-1 tw-bg-gray-100"}," Soni "),t("td",{class:"tw-border tw-p-1 tw-bg-gray-100"}," Kiritildi ")],-1),Ve={class:"tw-border px-1"},Ce=["onUpdate:modelValue"],$e={class:"tw-border px-1 tw-w-36 tw-leading-4"},ke={class:"tw-border px-1"},De={class:"tw-border px-1 tw-text-center"},Ue={class:"tw-border px-1"},Pe={class:"d-flex justify-space-between align-center"},Se=t("td",{class:"tw-border tw-h-[42px]"},null,-1),ze=t("td",{class:"tw-border"},null,-1),Me=t("td",{class:"tw-border"},null,-1),Fe=t("td",{class:"tw-border"},null,-1),Re=t("td",{class:"tw-border"},null,-1),je=t("td",{class:"tw-border"},null,-1),Be=[Se,ze,Me,Fe,Re,je],Ye={key:1},qe=t("td",{class:"tw-border tw-h-[42px]",colspan:"6"}," Mo'ljallangandan ortiqcha yo'lovchi biriktirilgan ",-1),Ne=[qe],He={class:"py-1 d-flex justify-end"},Te=Y({__name:"CarRideModal",setup(P,{expose:h}){const f=j(!1),i=Z(),s=B({dialog:!1}),g=j(),r=ae(),e=j(null);function p(_){axios.get(`car-ride/${_}`).then(async({data:l})=>{l.passengers.forEach(x=>x.loading=!1),e.value=l})}function c(_){e.value.passengers.push(_),i.createPassenger(_)}function $(_){const l=e.value.passengers.findIndex(x=>x.id==_.id);e.value.passengers[l]=_,i.updatePassenger(_)}async function w(_){r.dialog.open(()=>{r.dialog.title="Aniq o'chirmoqchimisiz ?",r.dialog.submit=async()=>{const l=e.value.passengers.find(x=>x.id==_);l.loading=!0,await axios.delete(`passenger-delete/${_}`).then(()=>{e.value.passengers=e.value.passengers.filter(x=>x.id!=_),i.deletedPassenger(l)}).catch(()=>l.loading=!1)}})}function u(){r.dialog.open(()=>{r.dialog.title="Haydovchi qatnovga junatildimi ?",r.dialog.submit=async()=>{f.value=!0,await i.sendRoad(e.value),f.value=!1,s.dialog=!1}})}const m=I(()=>e.value.passengers.reduce((_,l)=>_+=l.count,0));return h({openModal:_=>{s.dialog=!0,p(_)}}),(_,l)=>{const x=a("v-card-title"),N=a("v-icon"),R=a("v-btn"),H=a("v-spacer"),T=a("v-card-text"),J=a("v-divider"),te=a("v-card-actions"),ne=a("v-card"),oe=a("v-dialog"),K=G("maska");return d(),C(oe,{modelValue:s.dialog,"onUpdate:modelValue":l[3]||(l[3]=D=>s.dialog=D),scrollable:"",persistent:"",width:"850px"},{default:o(()=>[n(ne,{onVnodeUnmounted:l[2]||(l[2]=D=>e.value=null),class:"tw-relative"},{default:o(()=>[n(x,null,{default:o(()=>{var D,M;return[V(b((D=e.value)==null?void 0:D.car.type)+" - "+b((M=e.value)==null?void 0:M.car.number),1)]}),_:1}),n(T,{class:"px-4 py-3 d-flex flex-column",style:{height:"400px"}},{default:o(()=>{var D,M;return[t("main",ge,[we,(d(!0),y(z,null,S((D=e.value)==null?void 0:D.cities,(v,F)=>{var A,L;return d(),y("div",{class:X([[((A=e.value)==null?void 0:A.cities.length)==F+1?"tw-text-right":""],"bg-white tw-relative px-2 -tw-mx-2"])},[t("header",{class:X([[F!=0&&((L=e.value)==null?void 0:L.cities.length)-1!=F?"text-center":""],"tw-text-xs tw-text-gray-400"])},b(v.district.region.name),3),t("footer",xe,b(v.district.name),1)],2)}),256))]),t("aside",be,b((M=e.value)==null?void 0:M.price)+" so'm ",1),e.value?(d(),C(H,{key:0},{default:o(()=>[t("table",he,[ye,(d(!0),y(z,null,S(e.value.passengers,v=>(d(),y("tr",null,[t("td",{class:"tw-border px-1",style:se(`height: ${v.count*42}px;`)},b(v.name),5),t("td",Ve,[V(b(v.phone)+" ",1),E(t("input",{"onUpdate:modelValue":F=>v.phone=F,hidden:""},null,8,Ce),[[K,void 0,U(Q)],[W,v.phone]])]),t("td",$e,b(v.address),1),t("td",ke,b(v.end.region.name.replace("shahri","").replace("viloyati",""))+" "+b(v.end.name)+" "+b(m.value),1),t("td",De,[(d(!0),y(z,null,S(v.count,(F,A)=>(d(),y("div",null,[n(N,{size:"small",color:"pink"},{default:o(()=>[V("mdi-account")]),_:1})]))),256))]),t("td",Ue,[t("div",Pe,[V(b(U(ie)(v.created_at).format("YYYY.MM.DD HH:mm"))+" ",1),t("main",null,[n(R,{size:"x-small",icon:"mdi-pencil",onClick:F=>g.value.toggle(v),variant:"tonal",class:"mr-1"},null,8,["onClick"]),n(R,{size:"x-small",icon:"mdi-delete",variant:"tonal",loading:v.loading,onClick:F=>w(v.id)},null,8,["loading","onClick"])])])])]))),256)),e.value.free_seat>=m.value?(d(!0),y(z,{key:0},S(e.value.free_seat-m.value,v=>(d(),y("tr",null,Be))),256)):(d(),y("tr",Ye,Ne))]),t("div",He,[n(ve,{ride:e.value,onCreate:c,disabled:m.value==e.value.free_seat},null,8,["ride","disabled"]),n(fe,{ride:e.value,onUpdate:$,ref_key:"editPassengerForm",ref:g},null,8,["ride"])])]),_:1})):O("",!0)]}),_:1}),n(J,{class:"border-opacity-50"}),n(te,null,{default:o(()=>{var D,M;return[(D=e.value)!=null&&D.phone?(d(),C(R,{key:0,tag:"a","prepend-icon":"mdi-phone",href:`tel:${(M=e.value)==null?void 0:M.phone}`,class:"tw-inline-flex tw-items-center"},{default:o(()=>[E(t("input",{type:"text",class:"tw-w-[144px]","onUpdate:modelValue":l[0]||(l[0]=v=>e.value.phone=v),disabled:"",hidden:""},null,512),[[K,void 0,U(Q)],[W,e.value.phone]]),V(" "+b(e.value.phone),1)]),_:1},8,["href"])):O("",!0),n(R,{onClick:u,loading:f.value,"prepend-icon":"mdi-car-arrow-right",color:"primary",type:"submit",class:"ml-4",variant:"tonal"},{default:o(()=>[V(" Junatish ")]),_:1},8,["loading"]),n(H),n(R,{color:"primary",variant:"text",onClick:l[1]||(l[1]=v=>s.dialog=!1)},{default:o(()=>[V(" Yopish ")]),_:1})]}),_:1})]),_:1},512)]),_:1},8,["modelValue"])}}}),Ee={class:"w-50 tw-text-left"},Ie={class:"w-50 tw-text-right tw-font-bold text-pink-lighten-5"},Ae={class:"w-100 d-flex justify-space-between align-end"},Qe={class:"text-left"},Ge=Y({__name:"CarRideCard",props:["ride"],setup(P){const h=P,f=I(()=>h.ride.passengers.reduce((i,s)=>i+=s.count,0));return(i,s)=>{const g=a("v-icon"),r=a("v-sheet"),e=G("ripple");return E((d(),C(r,{tag:"button",elevation:"1",color:"pink",class:"d-flex w-100 justify-space-between tw-flex-wrap px-2 tw-py-1 rounded mb-1 tw-cursor-pointer"},{default:o(()=>[t("aside",Ee,b(h.ride.car.type),1),t("div",Ie,b(h.ride.price)+" so'm ",1),t("main",Ae,[t("div",Qe,[(d(!0),y(z,null,S(h.ride.free_seat,(p,c)=>(d(),y("span",null,[c<f.value?(d(),C(g,{key:0,size:"small"},{default:o(()=>[V("mdi-account")]),_:1})):(d(),C(g,{key:1,size:"small",color:"pink-lighten-2"},{default:o(()=>[V("mdi-account")]),_:1}))]))),256))]),n(ue,{id:h.ride.id,smButton:!0},null,8,["id"])])]),_:1})),[[e]])}}}),Je={class:"tw-text-xs"},Ke={class:"tw-absolute tw-inset-0"},Le=t("h3",{class:"text-center"},"Qatnovlar",-1),Oe={class:"d-flex flex-wrap"},We={class:"px-1 tw-w-64 tw-border-l first:tw-border-none"},Xe={class:"text-center text-pink tw-font-medium tw-text-xs tw-py-2 mb-2"},Ze=t("h3",{class:"text-center"}," Transport biriktirilmagan yo'lovchilar ",-1),et=t("section",null,null,-1),lt=Y({__name:"Operator",setup(P){const h=Z(),f=j(),i=de();h.indexCity(i.params.id);const s=B({tab:1,regions:null,panel:0});return axios.get("region").then(({data:g})=>s.regions=g),re(i,g=>{h.indexCity(g.params.id),s.panel=null}),(g,r)=>{const e=a("v-tab"),p=a("v-tabs"),c=a("v-expansion-panel-title"),$=a("v-col"),w=a("v-row"),u=a("v-expansion-panel-text"),m=a("v-expansion-panel"),k=a("v-expansion-panels"),_=a("v-spacer"),l=a("v-card");return d(),C(l,{class:"d-flex flex-column"},{default:o(()=>[n(p,{modelValue:s.tab,"onUpdate:modelValue":r[0]||(r[0]=x=>s.tab=x)},{default:o(()=>[(d(!0),y(z,null,S(s.regions,x=>(d(),C(e,{to:{name:"operator",params:{id:x.id}},value:x.id},{default:o(()=>[t("span",Je,b(x.name.replace("viloyati","")),1)]),_:2},1032,["to","value"]))),256))]),_:1},8,["modelValue"]),n(_,{class:"overflow-y-auto tw-relative"},{default:o(()=>[t("main",Ke,[n(_e,{btnClass:["!tw-bottom-3 !tw-right-3"]}),n(Te,{ref_key:"rideModal",ref:f},null,512),n(k,{modelValue:s.panel,"onUpdate:modelValue":r[1]||(r[1]=x=>s.panel=x),multiple:"",variant:"accordion"},{default:o(()=>[(d(!0),y(z,null,S(U(h).groupRides,(x,N)=>(d(),C(m,{elevation:"1"},{default:o(()=>[n(c,null,{default:o(()=>[V(b(N),1)]),_:2},1024),n(u,{class:"operator"},{default:o(()=>[n(w,{class:"ma-0"},{default:o(()=>[n($,{cols:"6",class:"tw-border-r px-1"},{default:o(()=>[Le,t("section",Oe,[(d(!0),y(z,null,S(x,(R,H)=>(d(),y("aside",We,[t("div",null,[t("header",Xe,[t("span",null,b(N),1),V(" - "+b(U(ce)(H,"viloyati","V.")),1)]),t("footer",null,[(d(!0),y(z,null,S(R,T=>(d(),C(Ge,{ride:T,onClick:J=>f.value.openModal(T.id)},null,8,["ride","onClick"]))),256))])])]))),256))])]),_:2},1024),n($,{cols:"6"},{default:o(()=>[Ze,et]),_:1})]),_:2},1024)]),_:2},1024)]),_:2},1024))),256))]),_:1},8,["modelValue"])])]),_:1})]),_:1})}}});export{lt as default};
