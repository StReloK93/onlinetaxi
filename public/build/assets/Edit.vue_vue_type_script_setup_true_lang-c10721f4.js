import{r as z,p as J,m as E,h as K}from"./constants-68fdd4d6.js";import{d as I,p as B,r as u,A as Y,o as g,c as h,w as r,f as i,i as P,j as A,y as W,F as H,h as w,e as R,B as O,D as X,g as Q,n as Z,C as ee,k as $,q as ae,x as q,S}from"./app-f063963f.js";const te={class:"d-flex w-100 mb-3"},le=R("img",{src:"/iconos/uz.png"},null,-1),j=I({__name:"Inputs",props:["edit","date"],setup(c,{expose:x}){const a=B({user_car_id:null,phone:null,strictly_on_time:!1,address_to_address:!1,ends:[{region:null,city:null,loading:!1,districts:[]},{region:null,city:null,loading:!1,districts:[]}],day:null,price:"",free_seat:null}),n=B({overlay:!0,cars:[],regions:[]});function m(o){a.ends.splice(o,1)}function C(o){const e=n.cars.find(v=>v.id==o);a.phone=e.user.phone}async function y(o,e){a.ends[e].loading=!0,a.ends[e].city=null,a.ends[e].districts=[],await axios.get(`district/${o}`).then(({data:v})=>{a.ends[e].districts=v,a.ends[e].loading=!1})}function p(){n.overlay=!1}return axios.all([axios.get("user-cars/get-only-my"),axios.get("region")]).then(axios.spread(({data:o},{data:e})=>{n.cars=o,n.regions=e})),x({regionChanged:y,formData:a,clearOverlay:p}),(o,e)=>{const v=u("v-progress-circular"),f=u("v-overlay"),V=u("v-label"),k=u("v-col"),F=u("v-autocomplete"),M=u("v-btn"),N=u("v-divider"),t=u("VDatePicker"),s=u("v-text-field"),d=u("v-icon"),_=u("v-switch"),D=u("v-row"),T=Y("maska"),L=Y("money3");return g(),h(D,null,{default:r(()=>[c.edit?(g(),h(f,{key:0,modelValue:n.overlay,"onUpdate:modelValue":e[0]||(e[0]=l=>n.overlay=l),contained:"",persistent:"",class:"align-center justify-center"},{default:r(()=>[i(v,{color:"primary",indeterminate:"",size:68})]),_:1},8,["modelValue"])):P("",!0),(g(!0),A(H,null,W(a.ends,(l,U)=>(g(),A(H,null,[U==0?(g(),h(k,{key:0,cols:"12",class:"py-1"},{default:r(()=>[i(V,{class:"text-subtitle-1 mr-1"},{default:r(()=>[Q(" Qaerdan? ")]),_:1})]),_:1})):P("",!0),a.ends.length==U+1?(g(),h(k,{key:1,cols:"12",class:"py-1"},{default:r(()=>[i(V,{class:"text-subtitle-1 mr-1"},{default:r(()=>[Q(" Qaerga? ")]),_:1})]),_:1})):P("",!0),R("div",{class:Z(["w-100 d-flex flex-wrap bg-blue-grey-lighten-5",{"px-0":[1,2].includes(U)&&U!=a.ends.length-1}])},[i(k,{sm:"6",cols:"12"},{default:r(()=>[i(F,{modelValue:l.region,"onUpdate:modelValue":[b=>l.region=b,b=>y(b,U)],items:n.regions,label:"Viloyat","item-title":"name","item-value":b=>b.id,rules:w(z)},null,8,["modelValue","onUpdate:modelValue","items","item-value","rules"])]),_:2},1024),i(k,{sm:"6",cols:"12",class:"d-flex align-center"},{default:r(()=>[i(F,{disabled:l.region==null,modelValue:l.city,"onUpdate:modelValue":b=>l.city=b,items:l.districts,label:"Shahar (Tuman)","item-title":"name","item-value":b=>b.id,loading:l.loading,rules:w(z)},null,8,["disabled","modelValue","onUpdate:modelValue","items","item-value","loading","rules"]),[1,2].includes(U)&&U!=a.ends.length-1?(g(),h(M,{key:0,onClick:b=>m(U),size:"x-small",icon:"mdi-minus",class:"ml-2",variant:"plain"},null,8,["onClick"])):P("",!0)]),_:2},1024)],2)],64))),256)),i(N,{class:"border-opacity-75"}),c.date?(g(),h(k,{key:1,sm:"6",cols:"12"},{default:r(()=>[i(t,{"trim-weeks":!0,color:"pink","min-date":new Date,modelValue:a.day,"onUpdate:modelValue":e[1]||(e[1]=l=>a.day=l),modelModifiers:{string:!0},masks:{modelValue:"YYYY-MM-DD HH:mm"},mode:"dateTime",is24hr:"",transparent:"",borderless:"",expanded:"","hide-time-header":"","is-required":""},null,8,["min-date","modelValue"]),i(s,{class:"hidden tw-relative -tw-top-2",hidden:"",modelValue:a.day,"onUpdate:modelValue":e[2]||(e[2]=l=>a.day=l),rules:w(z),readonly:""},null,8,["modelValue","rules"])]),_:1})):P("",!0),i(k,{sm:"6",cols:"12"},{default:r(()=>[i(F,{class:"mb-3","onUpdate:modelValue":[C,e[3]||(e[3]=l=>a.user_car_id=l)],items:n.cars,modelValue:a.user_car_id,label:"Transport","item-title":l=>`${l.car.name} ( ${l.number} )`,"item-value":l=>l.id,rules:w(z)},null,8,["items","modelValue","item-title","item-value","rules"]),R("main",te,[i(s,{class:"pr-2 flex-0-0",readonly:"",density:"compact",value:"+998",disabled:""},{"prepend-inner":r(()=>[i(d,null,{default:r(()=>[le]),_:1})]),_:1}),O(i(s,{modelValue:a.phone,"onUpdate:modelValue":e[4]||(e[4]=l=>a.phone=l),density:"compact",rules:w(z)},null,8,["modelValue","rules"]),[[T,void 0,w(J)]])]),i(s,{label:"Narxi",rules:w(z),modelValue:a.price,"onUpdate:modelValue":e[5]||(e[5]=l=>a.price=l),modelModifiers:{lazy:!0},class:"mb-3"},null,8,["rules","modelValue"]),i(s,{modelValue:a.free_seat,"onUpdate:modelValue":e[6]||(e[6]=l=>a.free_seat=l),type:"number",label:"Bosh o'rindiqlar",class:"mb-3",rules:w(z)},null,8,["modelValue","rules"]),O(R("input",{"onUpdate:modelValue":e[7]||(e[7]=l=>a.price=l),type:"text",hidden:""},null,512),[[L,w(E)],[X,a.price,void 0,{lazy:!0}]]),i(_,{modelValue:a.strictly_on_time,"onUpdate:modelValue":e[8]||(e[8]=l=>a.strictly_on_time=l),label:"Qat'iy shu vaqtda",class:"px-2"},null,8,["modelValue"]),i(_,{modelValue:a.address_to_address,"onUpdate:modelValue":e[9]||(e[9]=l=>a.address_to_address=l),label:"Manzilgacha",class:"px-2"},null,8,["modelValue"])]),_:1})]),_:1})}}}),G=ee("useCarRide",()=>{const c=$(null),x=$(null),a=$(null),n=$([]),m=$([]),C=$(["car-ride-height","tw-shadow","tw-border-l-2","tw-border-pink-500","bg-white","tw-rounded-r","overflow-hidden"]);function y(){axios.get("car-ride").then(({data:t})=>n.value=t)}async function p(t){axios.get(`car-rides/start-region/${t}`).then(({data:s})=>{n.value=s.car_rides,m.value=s.districts})}function o(t){n.value.push(t),c.value!=null&&(c.value.applyTransaction({add:[t],addIndex:0}),c.value.onFilterChanged())}function e(t){const s=n.value.findIndex(_=>_.id==t.id);if(n.value[s]=t,c.value==null)return;c.value.getRowNode(t.id).updateData(t),c.value.onFilterChanged()}function v(t){axios.delete(`car-ride/${t.id}`).then(()=>{n.value=n.value.filter(s=>s.id!=t.id),c.value!=null&&c.value.applyTransaction({remove:[t]})})}async function f(t){await axios.delete(`car-rides/send-road/${t.id}`).then(()=>{n.value=n.value.filter(s=>s.id!=t.id)})}const V=ae(()=>{var s;const t={};return(s=m.value)==null||s.forEach(d=>{n.value.forEach(_=>{if(d.id==_.cities[0].district_id){let D=`${_.cities.at(-1).district.region.name} ${_.cities.at(-1).district.name}`;const T=D.split(" ");K(T)&&(D=_.cities.at(-1).district.name),t[d.name]?t[d.name][D]?t[d.name][D].push(_):t[d.name][D]=[_]:(t[d.name]={},t[d.name][D]=[_])}})}),t});function k(t){n.value.find(d=>d.id==t.car_ride_id).passengers.push(t)}function F(t){const s=n.value.find(_=>_.id==t.car_ride_id),d=s.passengers.findIndex(_=>_.id==t.id);s.passengers[d]=t}function M(t){const s=n.value.find(d=>d.id==t.car_ride_id);s.passengers=s.passengers.filter(d=>d.id!=t.id)}function N(){c.value=null,x.value=null,a.value=null,n.value=[],m.value=[],C.value=[]}return{agGrid:c,agColumnApi:x,rides:n,agRowHeight:a,rowClass:C,districts:m,groupRides:V,sendRoad:f,create:o,update:e,destroy:v,index:y,indexCity:p,createPassenger:k,updatePassenger:F,deletedPassenger:M,clear:N}}),se=I({__name:"Add",props:["date","btnClass"],setup(c){const x=G(),a=c,n=$(),m=B({dialog:!1});async function C(){const y=n.value.formData;y.price=S(y.price,E),await axios.post("car-ride",y).then(({data:p})=>x.create(p))}return(y,p)=>{const o=u("v-btn"),e=u("CustomForm"),v=u("v-dialog");return g(),h(v,{modelValue:m.dialog,"onUpdate:modelValue":p[1]||(p[1]=f=>m.dialog=f),scrollable:"",width:"600px"},{activator:r(({props:f})=>[i(o,q({color:"primary"},f,{icon:"mdi-plus",class:[a.btnClass,"add-button"]}),null,16,["class"])]),default:r(()=>[i(e,{submit:C,title:"Qatnov kiritish",onClose:p[0]||(p[0]=f=>m.dialog=!1)},{default:r(()=>[i(j,{ref_key:"inputComponent",ref:n,date:a.date},null,8,["date"])]),_:1})]),_:1},8,["modelValue"])}}}),ie=I({__name:"Edit",props:["date","id","smButton"],setup(c){const x=G(),a=$(),n=c,m=B({dialog:!1,car_ride:null});async function C(){const p=a.value.formData;p.price=S(p.price,E),await axios.put(`car-ride/${m.car_ride.id}`,p).then(async({data:o})=>{x.update(o),m.dialog=!1})}function y(p){axios.get(`car-ride/${p}`).then(async({data:o})=>{m.car_ride=o;const e=a.value.formData;e.user_car_id=o.user_car_id,e.phone=o.phone,e.day=o.day,e.strictly_on_time=o.strictly_on_time,e.price=o.price,e.address_to_address=o.address_to_address,e.free_seat=o.free_seat,e.ends=[],await Promise.all(o.cities.map(async(v,f)=>{e.ends.push({region:null,city:null,loading:!1,districts:[]}),await a.value.regionChanged(v.district.region_id,f),e.ends[f].region=v.district.region_id,e.ends[f].city=v.district_id,a.value.clearOverlay()}))})}return(p,o)=>{const e=u("v-btn"),v=u("CustomForm"),f=u("v-dialog");return g(),h(f,{modelValue:m.dialog,"onUpdate:modelValue":o[2]||(o[2]=V=>m.dialog=V),scrollable:"",width:"600px"},{activator:r(({props:V})=>[n.smButton?(g(),h(e,q({key:0},V,{"prepend-icon":"mdi-pencil",size:"x-small",variant:"tonal",color:"white"}),{default:r(()=>[Q(" O'zgaritirish ")]),_:2},1040)):(g(),h(e,q({key:1,size:"x-small"},V,{variant:"plain",icon:"mdi-pencil"}),null,16))]),default:r(()=>[i(v,{submit:C,onVnodeMounted:o[0]||(o[0]=V=>y(n.id)),title:"Qatnovni tahrirlash",onClose:o[1]||(o[1]=V=>m.dialog=!1)},{default:r(()=>[i(j,{ref_key:"inputComponent",ref:a,edit:!0,date:n.date},null,8,["date"])]),_:1},512)]),_:1},8,["modelValue"])}}});export{se as _,ie as a,G as u};
