import{u as F,_ as B,a as E}from"./Edit.vue_vue_type_script_setup_true_lang-76a73cbd.js";import{d as M,p as G,q as S,s as I,r as d,o as l,c as V,w as i,e as a,f as s,g as x,v as P,i as C,m as A,a as H,b as q,j as w,F as Y,x as j,n as N,h as t,t as y,y as U,k as O,z as T}from"./app-33261b3f.js";import{m as L}from"./constants-68fdd4d6.js";const Q=M({__name:"Filter",setup(z,{expose:v}){const r=F(),e=G({start_city:null,end_city:null,day:null}),f=S(()=>r.rides==null?[]:r.rides.map(n=>{var o;return(o=n.cities[0])==null?void 0:o.district}).filter((n,o,_)=>o===_.findIndex(m=>m.id===n.id))),u=S(()=>{if(r.rides==null)return[];const c=[];return r.rides.forEach(n=>{n.cities.forEach((o,_)=>{_!=0&&c.push(o.district)})}),c.filter((n,o,_)=>o===_.findIndex(m=>m.id===n.id))});function R(c){var k;const n=e.day==null?null:A(e.day).format("YYYY-MM-DD"),o=[null,(k=c.data.cities[0])==null?void 0:k.district_id].includes(e.start_city),m=[null,...c.data.cities.filter((D,$)=>$!=0).map(D=>D==null?void 0:D.district_id)].includes(e.end_city),b=[A(c.data.day).format("YYYY-MM-DD"),null].includes(n);return o&&m&&b}const h=S(()=>Object.values(e).every(n=>[null,""].includes(n)));function g(){e.start_city=null,e.end_city=null,e.day=null}return v({filters:R,resetFilter:g,filtered:h}),I(()=>e,()=>r.agGrid.onFilterChanged(),{deep:!0}),(c,n)=>{const o=d("v-btn"),_=d("v-autocomplete"),m=d("v-col"),b=d("VDatePicker"),k=d("v-row"),D=d("v-card"),$=d("v-menu");return l(),V($,{"close-on-content-click":!1,location:"bottom"},{activator:i(({props:p})=>[a("main",null,[s(o,P({color:"primary",variant:"text"},p,{"prepend-icon":"mdi-filter"}),{default:i(()=>[x(" Filterlar ")]),_:2},1040),h.value==!1?(l(),V(o,{key:0,color:"primary",size:"x-small",variant:"text",onClick:g,icon:"mdi-close"})):C("",!0)])]),default:i(()=>[s(D,{elevation:"2",rounded:"sm",width:270},{default:i(()=>[s(k,{class:"ma-0"},{default:i(()=>[s(m,{cols:"12",class:"py-2"},{default:i(()=>[s(_,{label:"Shahar | A",modelValue:e.start_city,"onUpdate:modelValue":n[0]||(n[0]=p=>e.start_city=p),clearable:"",items:f.value,"item-title":"name","item-value":p=>p.id,variant:"plain"},null,8,["modelValue","items","item-value"])]),_:1}),s(m,{cols:"12",class:"py-2"},{default:i(()=>[s(_,{label:"Shahar | B",modelValue:e.end_city,"onUpdate:modelValue":n[1]||(n[1]=p=>e.end_city=p),clearable:"",items:u.value,"item-title":"name","item-value":p=>p.id,variant:"plain"},null,8,["modelValue","items","item-value"])]),_:1}),s(m,{cols:"12",class:"d-flex align-center flex-column py-0"},{default:i(()=>[s(b,{"trim-weeks":!0,"min-date":new Date,modelValue:e.day,"onUpdate:modelValue":n[2]||(n[2]=p=>e.day=p),mode:"date",transparent:"",borderless:"",expanded:""},null,8,["min-date","modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})}}}),J=M({__name:"Sorting",setup(z){const v=F();let r=0;const e=["asc","desc",null],f=()=>{v.agColumnApi.applyColumnState({state:[{colId:"ride_time",sort:e[r],sortIndex:1}]}),r<2?r++:r=0};return(u,R)=>{const h=d("v-btn");return l(),V(h,{onClick:f,variant:"plain",icon:"mdi-sort"})}}}),K={class:"w-100 d-flex flex-column"},W={class:"pa-2 tw-h-16 d-flex flex-column justify-space-between tw-relative"},X=a("div",{class:"tw-absolute tw-h-3/5 tw-border-l-2 tw-border-pink-500 tw-border-dotted tw-top-[10.5px] tw-left-[13px]"},null,-1),Z={key:0,class:"tw-leading-none d-flex align-center"},ee={class:"tw-font-bold"},te={class:"tw-text-xs ml-2 tw-text-gray-400"},ne={class:"px-2 pb-1 pt-4 d-flex flex-column justify-space-between tw-flex-grow"},ae={class:"flex-grow-1"},se={class:"d-flex justify-space-between"},oe={class:"tw-leading-none"},le={class:"tw-text-xl tw-leading-[3px]"},ie={class:"text-grey-darken-1 tw-text-base"},re={key:0,class:"tw-text-gray-500"},ce=["href"],de={class:"d-flex flex-column align-end"},ue={class:"text-right tw-leading-none"},_e={class:"d-flex justify-space-between align-center"},me={class:"tw-leading-none"},pe={class:"tw-text-gray-500 tw-translate-y-1"},fe={class:"tw-uppercase tw-text-2xl tw-font-semibold tw-text-gray-600 tw-inline-flex tw-items-center"},he={class:"d-flex align-center"},ye={key:0,class:"-tw-translate-x-28"},xe=M({__name:"CarRideRenderer",props:["params"],setup(z){const v=F(),e=z.params.data,f=H(),u=q(),R=g=>[0,e.cities.length-1].includes(g)==!0;function h(){f.dialog.open(()=>{f.dialog.title="Qatnovni o'chirmoqchimisiz ?",f.dialog.subTitle="O'chirilgan qatnovlarni qayta tiklashni imkoni yo'q",f.dialog.submit=()=>v.destroy(e)})}return(g,c)=>{const n=d("v-btn"),o=d("v-icon"),_=d("v-tooltip"),m=d("v-chip");return l(),w("section",K,[a("main",W,[s(n,{icon:"mdi-chevron-down",variant:"text",class:"tw-absolute tw-top-[26px] -tw-left-[10px]"}),X,(l(!0),w(Y,null,j(t(e).cities,(b,k)=>(l(),w(Y,null,[R(k)?(l(),w("aside",Z,[s(o,{class:N(["mr-2 tw-text-xs bg-white",{"tw-opacity-0":k==t(e).cities.length-1}]),color:"pink"},{default:i(()=>[x(" mdi-circle-outline ")]),_:2},1032,["class"]),a("span",ee,y(b.district.name),1),a("span",te,y(b.district.region.name.replace("viloyati","V.")),1)])):C("",!0)],64))),256))]),a("main",ne,[a("section",ae,[a("div",se,[a("main",oe,[a("div",le,[x(y(t(e).user_car.car.name)+" ",1),a("span",ie,y(t(e).user_car.number),1)]),t(u).user.role==3?(l(),w("div",re,[a("a",{href:`tel:${t(e).phone}`},y(t(e).phone),9,ce)])):C("",!0)]),a("main",de,[a("div",ue,[(l(!0),w(Y,null,j(t(e).free_seat,b=>(l(),V(o,{color:"pink"},{default:i(()=>[x(" mdi-account-settings ")]),_:1}))),256))])])])]),a("section",_e,[a("div",me,[a("p",pe,y(t(A)(t(e).day).format("HH:mm")),1),a("span",fe,[x(y(t(A)(t(e).day).format("D-MMMM"))+" ",1),t(e).strictly_on_time?(l(),V(n,{key:0,icon:"",size:"x-small",variant:"text"},{default:i(()=>[s(o,null,{default:i(()=>[x("mdi-book-clock")]),_:1}),s(_,{activator:"parent","open-on-click":!0,location:"bottom"},{default:i(()=>[x(" Qat'iy shu vaqtda ")]),_:1})]),_:1})):C("",!0)])]),a("div",he,[t(u).user.role==3||t(u).user.id==t(e).user_id?(l(),w("div",ye,[[1,2].includes(t(u).user.role_id)?(l(),V(n,{key:0,tag:"a",href:`tel:+998${t(e).phone}`,size:"small",variant:"plain",color:"teal",icon:"mdi-phone"},null,8,["href"])):C("",!0),s(t(B),{date:!0,id:t(e).id},null,8,["id"]),s(n,{size:"x-small",onClick:h,variant:"plain",icon:"mdi-delete",class:"ml-1"})])):C("",!0),s(m,{size:"large",variant:"tonal",color:"primary",class:"tw-font-semibold tw-absolute -tw-right-8 pr-10"},{default:i(()=>[x(y(t(U)(t(e).price,t(L)))+" so'm ",1)]),_:1})])])])])}}}),we=[{cellRenderer:xe,flex:1,valueFormatter:null,cellClass:["px-0","align-stretch"]},{field:"day",hide:!0},{field:"price",hide:!0},{field:"free_seat",hide:!0}],ve={class:"d-flex flex-column"},ge={class:"d-flex align-center justify-space-between w-100"},Ve=M({__name:"CarRides",setup(z){const v=q(),r=O(),e=F();e.index();function f(u){e.agGrid=u.api,e.agColumnApi=u.columnApi}return T(()=>{e.agGrid=null,e.agColumnApi=null}),(u,R)=>{const h=d("AgGridVue"),g=d("v-spacer");return l(),w("main",ve,[a("main",ge,[[1,2,4].includes(t(v).user.role_id)?(l(),V(t(E),{key:0,date:!0})):C("",!0),s(t(Q),{ref_key:"filterComponent",ref:r},null,512),s(t(J))]),s(g,null,{default:i(()=>[s(h,{class:"ag-theme-ruzzifer ag-theme-alpine h-100",animateRows:!0,defaultColDef:{sortable:!0},rowHeight:170,rowClass:t(e).rowClass,headerHeight:0,columnDefs:t(we),rowData:t(e).rides,onGridReady:f,getRowId:({data:c})=>c.id,doesExternalFilterPass:c=>r.value.filters(c),isExternalFilterPresent:()=>!0},null,8,["rowClass","columnDefs","rowData","getRowId","doesExternalFilterPass"])]),_:1})])}}});export{Ve as default};
