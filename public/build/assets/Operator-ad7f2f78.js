import{d as Y,k as B,p as j,r,o as c,c as V,w as o,y as O,g as $,f as t,S as le,A as J,h as P,e as n,B as T,v as I,a as se,t as h,j as C,q as U,F as S,i as X,C as Z,n as ee,D as ie,m as re,E as de,x as ce}from"./app-f25a100e.js";import{m as ue,r as q,p as Q,a as _e}from"./constants-68fdd4d6.js";import{u as K}from"./CarRide-c91fac1d.js";import{a as pe,_ as me}from"./Add.vue_vue_type_script_setup_true_lang-4a6c6994.js";const ve=Y({__name:"Edit",props:["date","id","smButton"],setup(k){const x=K(),p=B(),d=k,a=j({dialog:!1,car_ride:null});async function f(){const e=p.value.formData;e.price=le(e.price,ue),await axios.put(`car-ride/${a.car_ride.id}`,e).then(async({data:l})=>{x.update(l),a.dialog=!1})}function _(e){axios.get(`car-ride/${e}`).then(async({data:l})=>{a.car_ride=l;const s=p.value.formData;s.car_id=l.car_id,s.phone=l.phone,s.ride_time=l.ride_time,s.strictly_on_time=l.strictly_on_time,s.price=l.price,s.address_to_address=l.address_to_address,s.free_seat=l.free_seat,s.ends=[],await Promise.all(l.cities.map(async(y,m)=>{s.ends.push({region:null,city:null,loading:!1,districts:[]}),await p.value.regionChanged(y.district.region_id,m),s.ends[m].region=y.district.region_id,s.ends[m].city=y.district_id,p.value.clearOverlay()}))})}return(e,l)=>{const s=r("v-btn"),y=r("CustomForm"),m=r("v-dialog");return c(),V(m,{modelValue:a.dialog,"onUpdate:modelValue":l[2]||(l[2]=u=>a.dialog=u),scrollable:"",persistent:"",width:"600px"},{activator:o(({props:u})=>[d.smButton?(c(),V(s,O({key:0},u,{"prepend-icon":"mdi-pencil",size:"x-small",variant:"tonal",color:"white"}),{default:o(()=>[$(" O'zgaritirish ")]),_:2},1040)):(c(),V(s,O({key:1,size:"small"},u,{variant:"plain",icon:"mdi-pencil"}),null,16))]),default:o(()=>[t(y,{submit:f,onVnodeMounted:l[0]||(l[0]=u=>_(d.id)),title:"Qatnovni tahrirlash",onClose:l[1]||(l[1]=u=>a.dialog=!1)},{default:o(()=>[t(pe,{ref_key:"inputComponent",ref:p,edit:!0,date:d.date},null,8,["date"])]),_:1},512)]),_:1},8,["modelValue"])}}}),fe={class:"d-flex w-100"},ge=n("img",{src:"/iconos/uz.png"},null,-1),te=Y({__name:"Inputs",props:{freeSeat:{type:Number,required:!0},familyCount:{type:Number,default:0}},setup(k,{expose:x}){const p=k,d=j({car_ride_id:null,name:null,phone:null,loading:null,address:null,start_region:null,start_city:null,end_region:null,end_city:null,with_trunk:!1,ride_time:null,count:1}),a=j({start_loading:!1,end_loading:!1,regions:[],start_districts:[],end_districts:[]});async function f(_,e){a[`${e}_loading`]=!0,a[`${e}_districts`]=[],d[`${e}_city`]=null,await axios.get(`district/${_}`).then(({data:l})=>{a[`${e}_districts`]=l,a[`${e}_loading`]=!1})}return axios.get("region").then(({data:_})=>a.regions=_),x({regionChanged:f,formData:d}),(_,e)=>{const l=r("v-text-field"),s=r("v-col"),y=r("v-icon"),m=r("v-label"),u=r("v-autocomplete"),g=r("v-rating"),D=r("v-row"),v=J("maska");return c(),V(D,null,{default:o(()=>[t(s,{sm:"6",cols:"12"},{default:o(()=>[t(l,{modelValue:d.name,"onUpdate:modelValue":e[0]||(e[0]=i=>d.name=i),step:900,label:"F.I.SH",rules:P(q)},null,8,["modelValue","rules"])]),_:1}),t(s,{sm:"6",cols:"12"},{default:o(()=>[n("main",fe,[t(l,{class:"pr-2 flex-0-0",readonly:"",density:"compact",value:"+998",disabled:""},{"prepend-inner":o(()=>[t(y,null,{default:o(()=>[ge]),_:1})]),_:1}),T(t(l,{modelValue:d.phone,"onUpdate:modelValue":e[1]||(e[1]=i=>d.phone=i),density:"compact",rules:P(q)},null,8,["modelValue","rules"]),[[v,void 0,P(Q)]])])]),_:1}),t(s,{cols:"12",class:"py-0 text-center"},{default:o(()=>[t(m,{class:"text-caption"},{default:o(()=>[$(" Boriladigan manzil (Qaerga?) ")]),_:1})]),_:1}),t(s,{sm:"6",cols:"12"},{default:o(()=>[t(u,{"onUpdate:modelValue":[e[2]||(e[2]=i=>f(i,"end")),e[3]||(e[3]=i=>d.end_region=i)],items:a.regions,modelValue:d.end_region,label:"Viloyat","item-title":"name","item-value":i=>i.id,rules:P(q)},null,8,["items","modelValue","item-value","rules"])]),_:1}),t(s,{sm:"6",cols:"12"},{default:o(()=>[t(u,{disabled:d.end_region==null,items:a.end_districts,modelValue:d.end_city,"onUpdate:modelValue":e[4]||(e[4]=i=>d.end_city=i),label:"Shahar (Tuman)","item-title":"name","item-value":i=>i.id,loading:a.end_loading,rules:P(q)},null,8,["disabled","items","modelValue","item-value","loading","rules"])]),_:1}),t(s,{sm:"6",cols:"12"},{default:o(()=>[t(l,{modelValue:d.address,"onUpdate:modelValue":e[5]||(e[5]=i=>d.address=i),step:900,label:"Manzil",rules:P(q)},null,8,["modelValue","rules"])]),_:1}),t(s,{sm:"6",cols:"12",class:"overflow-hidden px-1"},{default:o(()=>[t(g,{density:"compact",modelValue:d.count,"onUpdate:modelValue":e[6]||(e[6]=i=>d.count=i),"empty-icon":"mdi-account-outline","full-icon":"mdi-account",class:"d-flex flex-wrap",length:p.freeSeat+p.familyCount,hover:""},null,8,["modelValue","length"])]),_:1})]),_:1})}}}),we=Y({__name:"Add",props:["ride","disabled"],emits:["create"],setup(k,{emit:x}){const p=k,d=x,a=B(),f=j({dialog:!1}),_=I(()=>{const l=p.ride.passengers.reduce((s,y)=>s+=y.count,0);return p.ride.free_seat-l});async function e(){const l=a.value.formData;l.start_city=p.ride.cities[0].district_id,l.car_ride_id=p.ride.id,await axios.post("passenger-operator",l).then(({data:s})=>{d("create",s)})}return(l,s)=>{const y=r("v-icon"),m=r("v-btn"),u=r("CustomForm"),g=r("v-dialog");return c(),V(g,{modelValue:f.dialog,"onUpdate:modelValue":s[1]||(s[1]=D=>f.dialog=D),scrollable:"",persistent:"",width:"600px"},{activator:o(({props:D})=>[t(m,O({density:"compact"},D,{disabled:p.disabled}),{default:o(()=>[t(y,null,{default:o(()=>[$("mdi-account-plus")]),_:1})]),_:2},1040,["disabled"])]),default:o(()=>[t(u,{submit:e,title:"Yo'lovchi kiritish",onClose:s[0]||(s[0]=D=>f.dialog=!1)},{default:o(()=>[t(te,{ref_key:"inputComponent",ref:a,freeSeat:_.value},null,8,["freeSeat"])]),_:1})]),_:1},8,["modelValue"])}}}),xe=Y({__name:"Edit",props:["ride"],emits:["update"],setup(k,{expose:x,emit:p}){const d=k,a=B(),f=p,_=j({dialog:!1,passenger:null}),e=I(()=>d.ride.passengers.reduce((m,u)=>m+=u.count,0));async function l(){const m=a.value.formData;m.start_city=d.ride.cities[0].district_id,m.car_ride_id=d.ride.id,await axios.put(`passenger/${_.passenger.id}`,m).then(({data:u})=>f("update",u))}function s(m){axios.get(`passenger/${m}`).then(({data:u})=>{const g=a.value.formData;g.name=u.name,g.phone=u.phone,g.address=u.address,g.count=u.count,g.end_region=u.end.region_id,a.value.regionChanged(g.end_region,"end").then(()=>g.end_city=u.end_city)})}return x({toggle:m=>{_.dialog=!0,_.passenger=m,s(m.id)}}),(m,u)=>{const g=r("CustomForm"),D=r("v-dialog");return c(),V(D,{modelValue:_.dialog,"onUpdate:modelValue":u[1]||(u[1]=v=>_.dialog=v),scrollable:"",persistent:"",width:"600px"},{default:o(()=>[t(g,{submit:l,title:"Yo'lovchini tahrirlash",onClose:u[0]||(u[0]=v=>_.dialog=!1)},{default:o(()=>[t(te,{ref_key:"inputComponent",ref:a,freeSeat:k.ride.free_seat-e.value,familyCount:_.passenger.count},null,8,["freeSeat","familyCount"])]),_:1})]),_:1},8,["modelValue"])}}}),be={class:"d-flex justify-space-between tw-relative"},he=n("div",{class:"tw-border-b tw-absolute tw-w-full tw-z-0 tw-bottom-[9px] tw-border-dashed tw-border-gray-400"},null,-1),ye={class:"tw-text-base"},Ce={class:"text-right my-2 tw-text-xl tw-text-pink-600 tw-font-semibold"},Ve={class:"w-100 tw-border-collapse tw-text-sm"},$e=n("tr",null,[n("td",{class:"tw-border tw-p-1 tw-bg-gray-100"}," F.I.SH "),n("td",{class:"tw-border tw-p-1 tw-bg-gray-100"}," Telefon "),n("td",{class:"tw-border tw-p-1 tw-bg-gray-100"}," Manzil "),n("td",{class:"tw-border tw-p-1 tw-bg-gray-100"}," Boriladigan manzil "),n("td",{class:"tw-border tw-p-1 tw-bg-gray-100"}," Soni "),n("td",{class:"tw-border tw-p-1 tw-bg-gray-100"}," Kiritildi ")],-1),ke={class:"tw-border px-1"},De=["onUpdate:modelValue"],ze={class:"tw-border px-1 tw-w-36 tw-leading-4"},Pe={class:"tw-border px-1"},Ue={class:"tw-border px-1 tw-text-center"},Se={class:"tw-border px-1"},Fe={class:"d-flex justify-space-between align-center"},Me=n("td",{class:"tw-border tw-h-[42px]"},null,-1),Re=n("td",{class:"tw-border"},null,-1),Be=n("td",{class:"tw-border"},null,-1),je=n("td",{class:"tw-border"},null,-1),Ye=n("td",{class:"tw-border"},null,-1),qe=n("td",{class:"tw-border"},null,-1),Ne=[Me,Re,Be,je,Ye,qe],Ee={key:1},He=n("td",{class:"tw-border tw-h-[42px]",colspan:"6"}," Mo'ljallangandan ortiqcha yo'lovchi biriktirilgan ",-1),Te=[He],Ie={class:"py-1 d-flex justify-end"},Ae=Y({__name:"CarRideModal",setup(k,{expose:x}){const p=B(!1),d=K(),a=j({dialog:!1}),f=B(),_=se(),e=B(null);function l(v){axios.get(`car-ride/${v}`).then(async({data:i})=>{i.passengers.forEach(b=>b.loading=!1),e.value=i})}function s(v){e.value.passengers.push(v),d.createPassenger(v)}function y(v){const i=e.value.passengers.findIndex(b=>b.id==v.id);e.value.passengers[i]=v,d.updatePassenger(v)}async function m(v){_.dialog.open(()=>{_.dialog.title="Aniq o'chirmoqchimisiz ?",_.dialog.submit=async()=>{const i=e.value.passengers.find(b=>b.id==v);i.loading=!0,await axios.delete(`passenger-delete/${v}`).then(()=>{e.value.passengers=e.value.passengers.filter(b=>b.id!=v),d.deletedPassenger(i)}).catch(()=>i.loading=!1)}})}function u(){_.dialog.open(()=>{_.dialog.title="Haydovchi qatnovga junatildimi ?",_.dialog.submit=async()=>{p.value=!0,await d.sendRoad(e.value),p.value=!1,a.dialog=!1}})}const g=I(()=>e.value.passengers.reduce((v,i)=>v+=i.count,0));return x({openModal:v=>{a.dialog=!0,l(v)}}),(v,i)=>{const b=r("v-card-title"),N=r("v-icon"),R=r("v-btn"),E=r("v-spacer"),H=r("v-card-text"),L=r("v-divider"),ne=r("v-card-actions"),oe=r("v-card"),ae=r("v-dialog"),G=J("maska");return c(),V(ae,{modelValue:a.dialog,"onUpdate:modelValue":i[3]||(i[3]=z=>a.dialog=z),scrollable:"",persistent:"",width:"850px"},{default:o(()=>[t(oe,{onVnodeUnmounted:i[2]||(i[2]=z=>e.value=null),class:"tw-relative"},{default:o(()=>[t(b,null,{default:o(()=>{var z,F;return[$(h((z=e.value)==null?void 0:z.car.type)+" - "+h((F=e.value)==null?void 0:F.car.number),1)]}),_:1}),t(H,{class:"px-4 py-3 d-flex flex-column",style:{height:"400px"}},{default:o(()=>{var z,F;return[n("main",be,[he,(c(!0),C(S,null,U((z=e.value)==null?void 0:z.cities,(w,M)=>{var A,W;return c(),C("div",{class:ee([[((A=e.value)==null?void 0:A.cities.length)==M+1?"tw-text-right":""],"bg-white tw-relative px-2 -tw-mx-2"])},[n("header",{class:ee([[M!=0&&((W=e.value)==null?void 0:W.cities.length)-1!=M?"text-center":""],"tw-text-xs tw-text-gray-400"])},h(w.district.region.name),3),n("footer",ye,h(w.district.name),1)],2)}),256))]),n("aside",Ce,h((F=e.value)==null?void 0:F.price)+" so'm ",1),e.value?(c(),V(E,{key:0},{default:o(()=>[n("table",Ve,[$e,(c(!0),C(S,null,U(e.value.passengers,w=>(c(),C("tr",null,[n("td",{class:"tw-border px-1",style:ie(`height: ${w.count*42}px;`)},h(w.name),5),n("td",ke,[$(h(w.phone)+" ",1),T(n("input",{"onUpdate:modelValue":M=>w.phone=M,hidden:""},null,8,De),[[G,void 0,P(Q)],[Z,w.phone]])]),n("td",ze,h(w.address),1),n("td",Pe,h(w.end.region.name.replace("shahri","").replace("viloyati",""))+" "+h(w.end.name)+" "+h(g.value),1),n("td",Ue,[(c(!0),C(S,null,U(w.count,(M,A)=>(c(),C("div",null,[t(N,{size:"small",color:"pink"},{default:o(()=>[$("mdi-account")]),_:1})]))),256))]),n("td",Se,[n("div",Fe,[$(h(P(re)(w.created_at).format("YYYY.MM.DD HH:mm"))+" ",1),n("main",null,[t(R,{size:"x-small",icon:"mdi-pencil",onClick:M=>f.value.toggle(w),variant:"tonal",class:"mr-1"},null,8,["onClick"]),t(R,{size:"x-small",icon:"mdi-delete",variant:"tonal",loading:w.loading,onClick:M=>m(w.id)},null,8,["loading","onClick"])])])])]))),256)),e.value.free_seat>=g.value?(c(!0),C(S,{key:0},U(e.value.free_seat-g.value,w=>(c(),C("tr",null,Ne))),256)):(c(),C("tr",Ee,Te))]),n("div",Ie,[t(we,{ride:e.value,onCreate:s,disabled:g.value==e.value.free_seat},null,8,["ride","disabled"]),t(xe,{ride:e.value,onUpdate:y,ref_key:"editPassengerForm",ref:f},null,8,["ride"])])]),_:1})):X("",!0)]}),_:1}),t(L,{class:"border-opacity-50"}),t(ne,null,{default:o(()=>{var z,F;return[(z=e.value)!=null&&z.phone?(c(),V(R,{key:0,tag:"a","prepend-icon":"mdi-phone",href:`tel:${(F=e.value)==null?void 0:F.phone}`,class:"tw-inline-flex tw-items-center"},{default:o(()=>[T(n("input",{type:"text",class:"tw-w-[144px]","onUpdate:modelValue":i[0]||(i[0]=w=>e.value.phone=w),disabled:"",hidden:""},null,512),[[G,void 0,P(Q)],[Z,e.value.phone]]),$(" "+h(e.value.phone),1)]),_:1},8,["href"])):X("",!0),t(R,{onClick:u,loading:p.value,"prepend-icon":"mdi-car-arrow-right",color:"primary",type:"submit",class:"ml-4",variant:"tonal"},{default:o(()=>[$(" Junatish ")]),_:1},8,["loading"]),t(E),t(R,{color:"primary",variant:"text",onClick:i[1]||(i[1]=w=>a.dialog=!1)},{default:o(()=>[$(" Yopish ")]),_:1})]}),_:1})]),_:1},512)]),_:1},8,["modelValue"])}}}),Oe={class:"w-50 tw-text-left"},Qe={class:"w-50 tw-text-right tw-font-bold text-pink-lighten-5"},Je={class:"w-100 d-flex justify-space-between align-end"},Ke={class:"text-left"},Le=Y({__name:"CarRideCard",props:["ride"],setup(k){const x=k,p=I(()=>x.ride.passengers.reduce((d,a)=>d+=a.count,0));return(d,a)=>{const f=r("v-icon"),_=r("v-sheet"),e=J("ripple");return T((c(),V(_,{tag:"button",elevation:"1",color:"pink",class:"d-flex w-100 justify-space-between tw-flex-wrap px-2 tw-py-1 rounded mb-1 tw-cursor-pointer"},{default:o(()=>[n("aside",Oe,h(x.ride.car.type),1),n("div",Qe,h(x.ride.price)+" so'm ",1),n("main",Je,[n("div",Ke,[(c(!0),C(S,null,U(x.ride.free_seat,(l,s)=>(c(),C("span",null,[s<p.value?(c(),V(f,{key:0,size:"small"},{default:o(()=>[$("mdi-account")]),_:1})):(c(),V(f,{key:1,size:"small",color:"pink-lighten-2"},{default:o(()=>[$("mdi-account")]),_:1}))]))),256))]),t(ve,{id:x.ride.id,smButton:!0},null,8,["id"])])]),_:1})),[[e]])}}}),Ge={class:"tw-text-xs"},We={class:"tw-absolute tw-inset-0"},Xe=n("h3",{class:"text-center"},"Qatnovlar",-1),Ze={class:"d-flex flex-wrap"},et={class:"px-1 tw-w-64 tw-border-l first:tw-border-none"},tt={class:"text-center text-pink tw-font-medium tw-text-xs tw-py-2 mb-2"},nt=n("h3",{class:"text-center"}," Transport biriktirilmagan yo'lovchilar ",-1),ot=n("section",null,null,-1),rt=Y({__name:"Operator",setup(k){const x=K(),p=B(),d=de();x.indexCity(d.params.id);const a=j({tab:1,regions:null,panel:0});return axios.get("region").then(({data:f})=>a.regions=f),ce(d,f=>{x.indexCity(f.params.id),a.panel=null}),(f,_)=>{const e=r("v-tab"),l=r("v-tabs"),s=r("v-expansion-panel-title"),y=r("v-col"),m=r("v-row"),u=r("v-expansion-panel-text"),g=r("v-expansion-panel"),D=r("v-expansion-panels"),v=r("v-spacer"),i=r("v-card");return c(),V(i,{class:"d-flex flex-column"},{default:o(()=>[t(l,{modelValue:a.tab,"onUpdate:modelValue":_[0]||(_[0]=b=>a.tab=b)},{default:o(()=>[(c(!0),C(S,null,U(a.regions,b=>(c(),V(e,{to:{name:"operator",params:{id:b.id}},value:b.id},{default:o(()=>[n("span",Ge,h(b.name.replace("viloyati","")),1)]),_:2},1032,["to","value"]))),256))]),_:1},8,["modelValue"]),t(v,{class:"overflow-y-auto tw-relative"},{default:o(()=>[n("main",We,[t(me,{btnClass:["!tw-bottom-3 !tw-right-3"]}),t(Ae,{ref_key:"rideModal",ref:p},null,512),t(D,{modelValue:a.panel,"onUpdate:modelValue":_[1]||(_[1]=b=>a.panel=b),multiple:"",variant:"accordion"},{default:o(()=>[(c(!0),C(S,null,U(P(x).groupRides,(b,N)=>(c(),V(g,{elevation:"1"},{default:o(()=>[t(s,null,{default:o(()=>[$(h(N),1)]),_:2},1024),t(u,{class:"operator"},{default:o(()=>[t(m,{class:"ma-0"},{default:o(()=>[t(y,{cols:"6",class:"tw-border-r px-1"},{default:o(()=>[Xe,n("section",Ze,[(c(!0),C(S,null,U(b,(R,E)=>(c(),C("aside",et,[n("div",null,[n("header",tt,[n("span",null,h(N),1),$(" - "+h(P(_e)(E,"viloyati","V.")),1)]),n("footer",null,[(c(!0),C(S,null,U(R,H=>(c(),V(Le,{ride:H,onClick:L=>p.value.openModal(H.id)},null,8,["ride","onClick"]))),256))])])]))),256))])]),_:2},1024),t(y,{cols:"6"},{default:o(()=>[nt,ot]),_:1})]),_:2},1024)]),_:2},1024)]),_:2},1024))),256))]),_:1},8,["modelValue"])])]),_:1})]),_:1})}}});export{rt as default};
